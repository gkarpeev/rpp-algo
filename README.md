# 78. RPP

Имплементируйте любой аппроксимационный алгоритм для задачи RPP с точностью $\frac{3}{2}$.

## Постановка
Дан граф $G=(V,E)$, веса рёбер $w:E \rightarrow N$, и множество рёбер $R \subset E$. Требуется найти цикл минимального суммарного веса, хотя бы один раз проходящий через каждое ребро из $R$.

## $\bf{NP}$-полнота

Мы можем свести задачу коммивояжера к задаче RPP. Допустим, у нас есть пример задачи TSP $(G,w)$, где $G$ — граф, а $w$ — стоимость рёбер. Давайте построим пример $(G', w', R)$ задачи RPP следующим образом:граф $G'$ получается из $G$ добавлением к каждой вершине петли с нулевой стоимостью. Множество $R$ состоит из добавленных петель. Теперь любое решение $W$ для TSP $(G, w)$ превращается в решение $W'$ для RPP $(G', w', R)$ путем добавления к $W$ петель из $R$. 

С другой стороны, любое решение $W'$ для примера RPP $(G', w', R)$ превращается в решение $W$ для примера TSP $(G, w)$ путем сокращения повторных посещений вершин. Стоимость оптимальных решений в обоих примерах одинакова.

---
## Аппроксимационный алгоритм 

https://www.researchgate.net/publication/239385320_An_algorithm_for_the_Rural_Postman_Problem

Эвристика состоит из трех этапов.
1. Преобразование графа ($G_R$) в полный граф.

2. На этапе II применяется minimal spanning tree.

3. Применяется алгоритм Minimal-cost matching. Затем на основе полученного графа можно построить обход почтальона.

Кратко рассмотрим эвристическую процедуру решения.

Фаза I (преобразование графа)

Шаг 1. Пусть $G_R=(V_R, E_R)$ - исходный граф. Преобразуем $G_R$ в полный граф
добавляя ребро между каждой парой вершин в $G_R$. Пусть $E_A$ — множество ребер, созданных в результате этого преобразования. Стоимость ребра (i, j)
в $E_A$ определяется как $c_{ij} =$ длина кратчайшего пути между вершинами i и j
из исходной сети. Назовем полученный граф $G_{RC_o} = (V_R, E_R \cup E_A)$.

Шаг 2. Упростим $G_{RC_o}$, исключив: (1) все ребра (i, j) из $E_A$, для которых стоимость ребра $c_{ij} = с_{ik} + с_{kj}$ для некоторого k и (2) все кратные ребра (кроме 1), если они имеют одинаковую стоимость. Назовем полученный граф $G_{RC}$.

Фаза II (MST)

Шаг 1. Пусть ${C_1, C_2 ..., C_r}$ — множество компонент из $G_R$, а $G_C$ — конденсированный граф, полученный из $G_R$ путем рассмотрения каждой компоненты как вершины. Ребро (i, j) из $G_C$ существует, если существует ребро (х, у) в $G_{RC}$ такое, что $х \in С_i, у \in C_j$. Определим стоимость ребра $(i, j) \in G_C$ как $d(i, j)= d(C_i, C_j)= min_{x,y} { (d(x, y) - u_x - u_y)}$, где
$u_x, u_y$ — коэффициенты.
    
Шаг 2. Применим алгоритм минимального остовного дерева (MST) к $G_C$. Пусть $E_T$ — множество ребер из решения MST.

Фаза III (Minimal-cost matching)

Решим CPP над $G_R \cup E_T$, применив minimal-cost matching. Пусть $E_M$ — полученное множество ребер.  Строим Эйлеров цикл. Тогда $G_R \cup E_T \cup E_M$ является искомым решением RPP.

Что касается множителей $u_x$ и $u_y$, рассматривается $u_i = -r(deg(i)-2)$, где r - константа, как показывает практика, лучше выбирать r = 1 или 2.

## Асимптотика

Таким образом, так как используется алгоритм Minimal-cost matching, то асимптотика будет $O(V^3)$.

## Точность

В случае когда граф удовлетворяет неравентсву треугольника итоговая точность будет $\frac{3}{2}$ в худшем случае. В анализе приведен пример, когда эта граница достижима.

## Анализ

Так же в анализе приведен пример работы алгоритма на графе троп парка.

analysis.ipynb